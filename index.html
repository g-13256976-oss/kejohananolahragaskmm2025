<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Keputusan Kejohanan Olahraga SK Mapan-Mapan, Pitas Kali Ke-18 Tahun 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #1e88e5;
            --secondary: #ff9800;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ffc107;
            --info: #00bcd4;
            --light: #f8f9fa;
            --dark: #343a40;
            --rentap: #e53935;
            --mat-salleh: #43a047;
            --hang-tuah: #1e88e5;
            --aki-antanom: #ff9800;
            --background-light: #f5f5f5;
            --text-light: #333;
            --card-light: #fff;
            --background-dark: #1a1a2e;
            --text-dark: #e6e6e6;
            --card-dark: #16213e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-light);
            color: var(--text-light);
            position: relative;
            min-height: 100vh;
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            z-index: -1;
        }

        body.dark-mode .background-image {
            opacity: 0.1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, #0d47a1 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        body.dark-mode header {
            background: linear-gradient(135deg, #0d47a1 0%, #000 100%);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .logo i {
            font-size: 40px;
            color: var(--primary);
        }

        .header-text h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-text h2 {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-button {
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 30px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        body.dark-mode .tab-button {
            background: var(--card-dark);
            color: var(--text-dark);
        }

        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .tab-button.active {
            background: var(--secondary);
            color: white;
        }

        body.dark-mode .tab-button.active {
            background: var(--warning);
            color: var(--dark);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card {
            background: var(--card-light);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .card {
            background: var(--card-dark);
        }

        .card h3 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .card h3 {
            color: #64b5f6;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            transition: all 0.3s;
        }

        body.dark-mode .search-box {
            background: #2d4059;
            border-color: #405c7a;
            color: var(--text-dark);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }

        .medal-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .medal-card {
            padding: 20px;
            border-radius: 10px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .medal-card:hover {
            transform: translateY(-5px);
        }

        .medal-card.rentap { background-color: var(--rentap); }
        .medal-card.mat-salleh { background-color: var(--mat-salleh); }
        .medal-card.hang-tuah { background-color: var(--hang-tuah); }
        .medal-card.aki-antanom { background-color: var(--aki-antanom); }

        .medal-card h4 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .medal-count {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .medal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .medal-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .medal-icon.gold { color: gold; }
        .medal-icon.silver { color: silver; }
        .medal-icon.bronze { color: #cd7f32; }

        .medal-number {
            font-size: 24px;
            font-weight: 700;
        }

        .event-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .event-table th, .event-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        body.dark-mode .event-table th,
        body.dark-mode .event-table td {
            border-bottom: 1px solid #405c7a;
        }

        .event-table th {
            background-color: #f2f2f2;
            font-weight: 600;
            color: var(--dark);
        }

        body.dark-mode .event-table th {
            background-color: #2d4059;
            color: var(--text-dark);
        }

        .event-table tr:hover {
            background-color: #f5f5f5;
        }

        body.dark-mode .event-table tr:hover {
            background-color: #2d4059;
        }

        .position-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            color: white;
            margin-right: 10px;
        }

        .position-1 { background-color: gold; color: #333; }
        .position-2 { background-color: silver; color: #333; }
        .position-3 { background-color: #cd7f32; color: white; }
        .position-4 { background-color: #757575; color: white; }

        .team-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .team-rentap { background-color: var(--rentap); }
        .team-mat-salleh { background-color: var(--mat-salleh); }
        .team-hang-tuah { background-color: var(--hang-tuah); }
        .team-aki-antanom { background-color: var(--aki-antanom); }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .chart-card {
            background: var(--card-light);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .chart-card {
            background: var(--card-dark);
        }

        .athlete-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .athlete-card {
            padding: 20px;
            border-radius: 10px;
            background: var(--card-light);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        body.dark-mode .athlete-card {
            background: var(--card-dark);
        }

        .athlete-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, #0d47a1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .athlete-info h4 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .athlete-info p {
            color: #666;
            margin-bottom: 5px;
        }

        body.dark-mode .athlete-info p {
            color: #aaa;
        }

        .points-badge {
            margin-left: auto;
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .qrcode-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        body.dark-mode .qrcode-container {
            background: #2d4059;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.dark-mode .filter-btn {
            background: #2d4059;
            color: var(--text-dark);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .admin-panel {
            background: #ffebee;
            border-left: 5px solid var(--danger);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        body.dark-mode .admin-panel {
            background: #2d1a1a;
            border-left: 5px solid #d32f2f;
        }

        .admin-panel h3 {
            color: var(--danger);
        }

        body.dark-mode .admin-panel h3 {
            color: #ef9a9a;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 10px 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .winner-highlight {
            animation: pulse 2s infinite;
            position: relative;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .mobile-menu {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            justify-content: space-around;
        }

        body.dark-mode .mobile-menu {
            background: var(--card-dark);
        }

        .mobile-menu-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: #666;
            font-size: 12px;
            cursor: pointer;
        }

        body.dark-mode .mobile-menu-btn {
            color: #aaa;
        }

        .mobile-menu-btn.active {
            color: var(--primary);
        }

        body.dark-mode .mobile-menu-btn.active {
            color: #64b5f6;
        }

        .mobile-menu-btn i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .empty-event {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-style: italic;
        }

        body.dark-mode .empty-event {
            color: #aaa;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-light);
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .modal-content {
            background: var(--card-dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        body.dark-mode .modal-header {
            border-bottom: 1px solid #405c7a;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
        }

        body.dark-mode .modal-header h3 {
            color: #64b5f6;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        body.dark-mode .close-modal {
            color: #aaa;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
        }

        body.dark-mode .form-control {
            background: #2d4059;
            border-color: #405c7a;
            color: var(--text-dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }

        .participant-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .participant-row input {
            flex: 1;
        }

        .remove-participant {
            background: var(--danger);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-participant {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        body.dark-mode .modal-actions {
            border-top: 1px solid #405c7a;
        }

        .save-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .event-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-complete {
            background-color: #d4edda;
            color: #155724;
        }

        body.dark-mode .status-complete {
            background-color: #1e4620;
            color: #c8e6c9;
        }

        .status-incomplete {
            background-color: #f8d7da;
            color: #721c24;
        }

        body.dark-mode .status-incomplete {
            background-color: #4a1c24;
            color: #f8d7da;
        }

        .incomplete-event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        body.dark-mode .incomplete-event-item {
            border-bottom: 1px solid #405c7a;
        }

        .event-actions {
            display: flex;
            gap: 5px;
        }

        .edit-event-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .header-text h1 {
                font-size: 20px;
            }
            
            .header-text h2 {
                font-size: 16px;
            }
            
            .nav-tabs {
                display: none;
            }
            
            .mobile-menu {
                display: flex;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .medal-analysis {
                grid-template-columns: 1fr;
            }
            
            .athlete-analysis {
                grid-template-columns: 1fr;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .participant-row {
                flex-direction: column;
                gap: 5px;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="background-image"></div>
    
    <!-- Modal for updating events -->
    <div class="modal-overlay" id="updateEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Kemaskini Keputusan Acara</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <form id="updateEventForm">
                <div class="form-group">
                    <label for="eventSelect">Pilih Acara:</label>
                    <select class="form-control" id="eventSelect" required>
                        <option value="">-- Sila pilih acara --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="eventName">Nama Acara:</label>
                    <input type="text" class="form-control" id="eventName" required>
                </div>
                
                <div class="form-group">
                    <label>Kategori:</label>
                    <div style="display: flex; gap: 20px;">
                        <div>
                            <input type="radio" id="categoryField" name="category" value="field" checked>
                            <label for="categoryField">Acara Padang</label>
                        </div>
                        <div>
                            <input type="radio" id="categoryTrack" name="category" value="track">
                            <label for="categoryTrack">Acara Balapan</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Jantina:</label>
                    <div style="display: flex; gap: 20px;">
                        <div>
                            <input type="radio" id="genderMale" name="gender" value="male" checked>
                            <label for="genderMale">Lelaki</label>
                        </div>
                        <div>
                            <input type="radio" id="genderFemale" name="gender" value="female">
                            <label for="genderFemale">Perempuan</label>
                        </div>
                        <div>
                            <input type="radio" id="genderMixed" name="gender" value="mixed">
                            <label for="genderMixed">Campuran</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ageGroup">Kumpulan Umur:</label>
                    <select class="form-control" id="ageGroup" required>
                        <option value="12TKB">12 Tahun Ke Bawah</option>
                        <option value="9TKB">9 Tahun Ke Bawah</option>
                        <option value="preschool">Prasekolah</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Keputusan Peserta:</label>
                    <div id="participantsContainer">
                        <!-- Participants will be added here dynamically -->
                    </div>
                    <button type="button" class="add-participant" id="addParticipant">
                        <i class="fas fa-plus"></i> Tambah Peserta
                    </button>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancelUpdate">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="save-btn">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="container">
        <header>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
            
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-running"></i>
                </div>
                <div class="header-text">
                    <h1>Sistem Keputusan Kejohanan Olahraga</h1>
                    <h2>SK Mapan-Mapan, Pitas Kali Ke-18 Tahun 2025</h2>
                    <p><i class="fas fa-medal"></i> ILMU • CITA • JAYA <i class="fas fa-trophy"></i></p>
                </div>
            </div>
        </header>
        
        <div class="nav-tabs">
            <button class="tab-button active" data-tab="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="tab-button" data-tab="field">
                <i class="fas fa-landmark"></i> Acara Padang
            </button>
            <button class="tab-button" data-tab="track">
                <i class="fas fa-running"></i> Acara Balapan
            </button>
            <button class="tab-button" data-tab="medals">
                <i class="fas fa-medal"></i> Jumlah Pingat
            </button>
            <button class="tab-button" data-tab="athletes">
                <i class="fas fa-users"></i> Olahragawan/Olahragawati
            </button>
            <button class="tab-button" data-tab="analysis">
                <i class="fas fa-chart-bar"></i> Analisis
            </button>
            <button class="tab-button" data-tab="qr">
                <i class="fas fa-qrcode"></i> QR Code
            </button>
            <button class="tab-button" data-tab="admin">
                <i class="fas fa-cogs"></i> Admin
            </button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h3><i class="fas fa-tachometer-alt"></i> Dashboard Utama</h3>
                <p>Selamat datang ke Sistem Keputusan Kejohanan Olahraga SK Mapan-Mapan, Pitas Kali Ke-18 Tahun 2025. Sistem ini memaparkan keputusan semua acara padang dan balapan.</p>
                
                <div class="medal-analysis" id="dashboardMedals">
                    <!-- Medals will be populated by JavaScript -->
                </div>
                
                <div class="chart-container">
                    <div class="chart-card">
                        <canvas id="medalChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="medalTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportDashboard">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Field Events Tab -->
        <div id="field" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-landmark"></i> Acara Padang</h3>
                
                <div class="search-container">
                    <input type="text" class="search-box" id="searchField" placeholder="Cari peserta acara padang...">
                </div>
                
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">Semua</button>
                    <button class="filter-btn" data-filter="male">Lelaki</button>
                    <button class="filter-btn" data-filter="female">Perempuan</button>
                    <button class="filter-btn" data-filter="12TKB">12 Tahun Ke Bawah</button>
                </div>
                
                <div id="fieldEventsContent">
                    <!-- Field events will be populated by JavaScript -->
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportField">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Track Events Tab -->
        <div id="track" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-running"></i> Acara Balapan</h3>
                
                <div class="search-container">
                    <input type="text" class="search-box" id="searchTrack" placeholder="Cari peserta acara balapan...">
                </div>
                
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">Semua</button>
                    <button class="filter-btn" data-filter="male">Lelaki</button>
                    <button class="filter-btn" data-filter="female">Perempuan</button>
                    <button class="filter-btn" data-filter="mixed">Campuran</button>
                    <button class="filter-btn" data-filter="preschool">Prasekolah</button>
                    <button class="filter-btn" data-filter="9TKB">9 Tahun Ke Bawah</button>
                    <button class="filter-btn" data-filter="12TKB">12 Tahun Ke Bawah</button>
                </div>
                
                <div id="trackEventsContent">
                    <!-- Track events will be populated by JavaScript -->
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportTrack">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Medals Tab -->
        <div id="medals" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-medal"></i> Jumlah Pingat Mengikut Pasukan</h3>
                
                <div class="medal-analysis" id="medalAnalysis">
                    <!-- Medal analysis will be populated by JavaScript -->
                </div>
                
                <div class="chart-container">
                    <div class="chart-card">
                        <canvas id="teamMedalChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="medalPieChart"></canvas>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportMedals">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Athletes Tab -->
        <div id="athletes" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-users"></i> Olahragawan dan Olahragawati</h3>
                
                <div class="filters">
                    <button class="filter-btn active" data-athlete-filter="all">Semua</button>
                    <button class="filter-btn" data-athlete-filter="male">Olahragawan</button>
                    <button class="filter-btn" data-athlete-filter="female">Olahragawati</button>
                    <button class="filter-btn" data-athlete-filter="preschool">Prasekolah</button>
                </div>
                
                <div id="topAthletesContent">
                    <!-- Top athletes will be populated by JavaScript -->
                </div>
                
                <div class="chart-container">
                    <div class="chart-card">
                        <canvas id="topAthletesChart"></canvas>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportAthletes">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Analysis Tab -->
        <div id="analysis" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Analisis Keputusan</h3>
                
                <div class="chart-container">
                    <div class="chart-card">
                        <canvas id="teamPointsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="genderDistributionChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-card">
                        <canvas id="ageGroupChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <canvas id="eventTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="export-btn" id="exportAnalysis">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- QR Code Tab -->
        <div id="qr" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-qrcode"></i> QR Code Keputusan</h3>
                <p>Scan QR code di bawah untuk mengakses sistem keputusan ini di peranti mudah alih:</p>
                
                <div class="qrcode-container">
                    <div id="qrcode"></div>
                </div>
                
                <p style="text-align: center; margin-top: 20px;">Simpan QR code ini untuk akses pantas kepada keputusan kejohanan.</p>
                
                <div class="action-buttons">
                    <button class="export-btn" id="downloadQR">
                        <i class="fas fa-download"></i> Muat Turun QR Code
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-cogs"></i> Panel Pentadbir Sukan</h3>
                <p>Panel ini membolehkan pentadbir mengemas kini keputusan acara yang belum selesai dan mengurus data kejohanan.</p>
                
                <div class="admin-panel">
                    <h3><i class="fas fa-exclamation-circle"></i> Acara Belum Selesai</h3>
                    <p>Acara berikut masih belum mempunyai keputusan penuh:</p>
                    <ul id="incompleteEvents">
                        <!-- Incomplete events will be populated by JavaScript -->
                    </ul>
                    
                    <div class="admin-controls">
                        <button class="admin-btn" id="updateResults">
                            <i class="fas fa-edit"></i> Kemaskini Keputusan
                        </button>
                        <button class="admin-btn" id="addEvent">
                            <i class="fas fa-plus-circle"></i> Tambah Acara Baru
                        </button>
                        <button class="admin-btn" id="resetData">
                            <i class="fas fa-redo"></i> Reset Data
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4><i class="fas fa-database"></i> Import Data</h4>
                    <p>Muat naik fail CSV untuk mengemaskini keputusan:</p>
                    <input type="file" id="csvUpload" accept=".csv" style="margin-top: 10px;">
                    <button class="admin-btn" id="importCSV" style="margin-top: 10px;">
                        <i class="fas fa-upload"></i> Import CSV
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu">
            <button class="mobile-menu-btn active" data-tab="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </button>
            <button class="mobile-menu-btn" data-tab="field">
                <i class="fas fa-landmark"></i>
                <span>Padang</span>
            </button>
            <button class="mobile-menu-btn" data-tab="track">
                <i class="fas fa-running"></i>
                <span>Balapan</span>
            </button>
            <button class="mobile-menu-btn" data-tab="medals">
                <i class="fas fa-medal"></i>
                <span>Pingat</span>
            </button>
            <button class="mobile-menu-btn" data-tab="athletes">
                <i class="fas fa-users"></i>
                <span>Atlet</span>
            </button>
        </div>
    </div>

    <script>
        // Data from PDF files
        let fieldEvents = [
            {
                id: 1,
                name: "Lompat Jauh Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MOHD ROYY SHAFIEY", distance: "3.60 M", position: 1, team: "RENTAP" },
                    { name: "MUHAMMAD EKWAL DON BIN ABDULLAH", distance: "3.51 M", position: 2, team: "MAT SALLEH" },
                    { name: "MOHAMMAD RENDI BOY BIN ABDULLAH", distance: "3.50 M", position: 3, team: "HANG TUAH" },
                    { name: "MOHAMAD FIRDAUS BIN MOHAMMAD RIAN", distance: "3.27 M", position: 4, team: "AKI ANTANOM" }
                ]
            },
            {
                id: 2,
                name: "Lompat Jauh Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "REZELAYNE JUDIP", distance: "2.70 m", position: 1, team: "RENTAP" },
                    { name: "NUR QISYATUL QHAYRRA ZANIA BINTI ZAKARIA", distance: "2.17 m", position: 2, team: "AKI ANTANOM" },
                    { name: "NUR IZZQUEISHA AIN BINTI JAFNAR", distance: "2.13 m", position: 3, team: "AKI ANTANOM" }
                ]
            },
            {
                id: 3,
                name: "Lontar Peluru Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MOHAMAD AZMIR BIN INDAN", distance: "5.03 m", position: 1, team: "HANG TUAH" },
                    { name: "MUHAMMAD FURQAN AL FATIH BIN LURSAN", distance: "4.50 m", position: 2, team: "HANG TUAH" },
                    { name: "MOHAMMAD SHAHDIQAH BIN ABDULLAH", distance: "4.29 m", position: 3, team: "AKI ANTANOM" },
                    { name: "MOHD ROYY SHAFIE", distance: "4.10 m", position: 4, team: "RENTAP" }
                ]
            },
            {
                id: 4,
                name: "Lontar Peluru Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "NURSAZWANI BINTI LISMAN", distance: "5.65 M", position: 1, team: "AKI ANTANOM" },
                    { name: "SITTI NUR QIANA UMAIRAH BINTI MAHADI", distance: "5.64 M", position: 2, team: "HANG TUAH" },
                    { name: "NORFASHA BINTI AMAN", distance: "5.12 M", position: 3, team: "AKI ANTANOM" },
                    { name: "ASMINI BINTI HAMID", distance: "5.04 M", position: 4, team: "MAT SALLEH" }
                ]
            },
            {
                id: 5,
                name: "Lompat Tinggi Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MOHAMMAD AMIRUL KHAIRUDIN BIN MOHD AZMI", height: "1.10 METER", position: 1, team: "HANG TUAH" },
                    { name: "MOHAMMAD SUFI BIN SEDEDIN", height: "0.93 METER", position: 2, team: "MAT SALLEH" },
                    { name: "MOHAMMAD HARFEY BIN HARDY", height: "0.90 METER", position: 3, team: "MAT SALLEH" }
                ]
            },
            {
                id: 6,
                name: "Lompat Tinggi Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "SITTY NUR ASYIRAH BINTI ROSLI", height: "1.10 METER", position: 1, team: "AKI ANTANOM" },
                    { name: "NUR ALEYA MAISARA BINTI AMRAN", height: "0.90 METER", position: 2, team: "MAT SALLEH" },
                    { name: "NORFASHA BINTI AMAN", height: "0.85 METER", position: 3, team: "AKI ANTANOM" }
                ]
            }
        ];

        let trackEvents = [
            {
                id: 1,
                name: "50 Meter Lelaki Prasekolah",
                gender: "male",
                ageGroup: "preschool",
                results: [
                    { name: "MUHAMMAD REZZA ZAKWAN BIN ABDULLAH", time: "14.62", position: 1, team: "" },
                    { name: "MOHAMMAD AFIQ AMANI BIN GABAN", time: "14.75", position: 2, team: "" },
                    { name: "MOHAMMAD QAISER BIN BERUSLI", time: "15.31", position: 3, team: "" },
                    { name: "DANIEL BIN JULMAN", time: "15.50", position: 4, team: "" }
                ]
            },
            {
                id: 2,
                name: "50 Meter Perempuan Prasekolah",
                gender: "female",
                ageGroup: "preschool",
                results: [
                    { name: "NUR HAYANA BINTI HARDY", time: "16.31", position: 1, team: "" },
                    { name: "FIDASARI LU BINTI MOHAMMAD RIAN", time: "17.15", position: 2, team: "" },
                    { name: "NUR ELISYA SAFIYA BINTI NUSRI", time: "17.43", position: 3, team: "" },
                    { name: "SYIFA NUR UWAIDAH BINTI ANDIKA", time: "19.47", position: 4, team: "" }
                ]
            },
            {
                id: 3,
                name: "100 Meter Lelaki 9TKB",
                gender: "male",
                ageGroup: "9TKB",
                results: [
                    { name: "DANISH BIN JEFRI", time: "16.72", position: 1, team: "RENTAP" },
                    { name: "MOHAMMAD FIRMAN NAIM BIN MOHAMMAD RIAN", time: "16.94", position: 2, team: "AKI ANTANOM" },
                    { name: "MUHD AL MALIK BIN MOHD KAHIRUL", time: "18.25", position: 3, team: "RENTAP" },
                    { name: "ABD ADH HAKIM BIN ABDULLAH", time: "18.37", position: 4, team: "HANG TUAH" }
                ]
            },
            {
                id: 4,
                name: "100 Meter Perempuan 9TKB",
                gender: "female",
                ageGroup: "9TKB",
                results: [
                    { name: "NURERYANI SUFI BINTI ABDULLAH", time: "18.53", position: 1, team: "MAT SALLEH" },
                    { name: "NUR QISYATUL QHAYRRA ZANIA BINTI ZAKARIA", time: "18.78", position: 2, team: "AKI ANTANOM" },
                    { name: "NORASLEYANNAH BINTI ABDULLAH", time: "19.19", position: 3, team: "AKI ANTANOM" },
                    { name: "NUR MIA ADRIANA BINTI AMRAN", time: "20.75", position: 4, team: "RENTAP" }
                ]
            },
            {
                id: 5,
                name: "100 Meter Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MOHAMMAD SHAHFIQ FARHAN BIN DALSAH", time: "16.00", position: 1, team: "RENTAP" },
                    { name: "MOHAMAD FIRDAUS BIN MOHAMMAD RIAN", time: "16.10", position: 2, team: "AKI ANTANOM" },
                    { name: "SAIFUL AZAM BIN ABDULLAH", time: "16.14", position: 3, team: "MAT SALLEH" },
                    { name: "MOHAMAD SYAFIQ BIN SATRIA", time: "16.50", position: 4, team: "MAT SALLEH" }
                ]
            },
            {
                id: 6,
                name: "100 Meter Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "SITTY NUR ASYIRAH BINTI ROSLI", time: "16.62", position: 1, team: "AKI ANTANOM" },
                    { name: "SITTI NUR QIANA UMAIRAH BINTI MAHAD", time: "16.67", position: 2, team: "HANG TUAH" },
                    { name: "NUR FAIEISYA FIETIEYA BINTI ABDULLAH", time: "17.94", position: 3, team: "MAT SALLEH" },
                    { name: "ANGIE CRYSTAL JIMMY", time: "19.28", position: 4, team: "HANG TUAH" }
                ]
            },
            {
                id: 7,
                name: "200 Meter Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MUHAMMAD SHAFIQ FARHAN BIN DALSAH", time: "35.47", position: 1, team: "RENTAP" },
                    { name: "MOHAMMAD ALFAH BIN ABDULLAH", time: "36.19", position: 2, team: "AKI ANTANOM" },
                    { name: "SAIFUL AZAM BIN ABDULLAH", time: "36.91", position: 3, team: "MAT SALLEH" },
                    { name: "MUHAMMAD EKWAL DON BIN ABDULLAH", time: "42.06", position: 4, team: "MAT SALLEH" }
                ]
            },
            {
                id: 8,
                name: "200 Meter Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "SITI NORHIDAYAH BINTI ABDULLAH", time: "39.06", position: 1, team: "RENTAP" },
                    { name: "ANGIE CRYSTAL JIMMY", time: "40.85", position: 2, team: "HANG TUAH" },
                    { name: "NUR IZZQUEISHA AIN BINTI JAFNAR", time: "46.85", position: 3, team: "AKI ANTANOM" },
                    { name: "NUR SHUHADA BINTI ABDULLAH", time: "52.97", position: 4, team: "MAT SALLEH" }
                ]
            },
            {
                id: 9,
                name: "80 Meter Berpagar Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { name: "MOHAMMAD HARFEY BIN HARDY", time: "16.41s", position: 1, team: "MAT SALLEH" },
                    { name: "MOHAMMAD ALFAH BIN ABDULLAH", time: "16.72", position: 2, team: "AKI ANTANOM" },
                    { name: "DANIAL BIN ABDULLAH", time: "17.86", position: 3, team: "RENTAP" },
                    { name: "MOHAMMAD MUZAIDIL IDZHAM BIN MASRA", time: "17.89", position: 4, team: "RENTAP" }
                ]
            },
            {
                id: 10,
                name: "80 Meter Berpagar Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { name: "SITI NORHIDAYAH BINTI ABDULLAH", time: "15.45", position: 1, team: "RENTAP" },
                    { name: "NUR ALEYA MAISARA BINTI AMRAN", time: "19.60", position: 2, team: "MAT SALLEH" },
                    { name: "NURSAZWANI BINTI LISMAN", time: "20.28", position: 3, team: "AKI ANTANOM" },
                    { name: "REZELAYNE JUDIP", time: "20.97", position: 4, team: "RENTAP" }
                ]
            },
            {
                id: 11,
                name: "4 X 50 Meter Campuran Prasekolah",
                gender: "mixed",
                ageGroup: "preschool",
                results: []
            },
            {
                id: 12,
                name: "4 X 100 Meter Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: [
                    { 
                        name: "MAT SALLEH Team", 
                        time: "1:08:87", 
                        position: 1, 
                        team: "MAT SALLEH",
                        participants: [
                            "MOHAMAD SYAFIQ BIN SATRIA",
                            "MUHAMMAD AZHARI BIN ABDULLAH",
                            "MOHAMMAD SUFI BIN SEDEDIN",
                            "MUHAMMAD EKWAL DON BIN ABDULLAH",
                            "MOHAMMAD HARFEY BIN HARDY",
                            "SAIFUL AZMI BIN ABDULLAH"
                        ]
                    },
                    { 
                        name: "AKI ANTANOM Team", 
                        time: "1:10:50", 
                        position: 2, 
                        team: "AKI ANTANOM",
                        participants: [
                            "MOHAMAD FIRDAUS BIN MOHAMMAD RIAN",
                            "MUHAMMAD ARMANSYAH BIN MOHD KUMAR",
                            "MOHAMMAD SHAHDIQAH BIN ABDULLAH",
                            "MOHAMMAD ALFAH BIN ABDULLAH",
                            "MUHAMMAD AL MUHAMN BIN ANDIKA",
                            "MOHAMMAD FIRMAN NAIM BIN MOHAMMAD RIAN"
                        ]
                    },
                    { 
                        name: "HANG TUAH Team", 
                        time: "1:12:07", 
                        position: 3, 
                        team: "HANG TUAH",
                        participants: [
                            "MUHAMMAD QAYYEL AKIM BIN ZAKARIA",
                            "MUHAMMAD FURQAN AL FATIH BIN LURSAN",
                            "MOHAMMAD AMIRUL KHAIRUDIN BIN MOHD AZMI",
                            "MOHAMMAD RENDI BOY BIN ABDULLAH",
                            "ABD ADH HAKIM BIN ABDULLAH",
                            "MUHAMMAD FITRI AL FATTAH BIN LURSAN"
                        ]
                    },
                    { 
                        name: "RENTAP Team", 
                        time: "1:12:60", 
                        position: 4, 
                        team: "RENTAP",
                        participants: [
                            "MUHAMMAD SHAFIQ FARHAN BIN DALSAH",
                            "DANIAL BIN ABDULLAH",
                            "MOHD ROYY SHAFIEY",
                            "MOHAMAD MUZAIDIL IDZHAM BIN MASRA",
                            "MOHAMAD HANAFFY BIN HARDY",
                            "MUHAMMAD AMIRUL ASYRAF BIN AMIRDIN"
                        ]
                    }
                ]
            },
            {
                id: 13,
                name: "4 X 100 Meter Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: [
                    { 
                        name: "MAT SALLEH Team", 
                        time: "1:16:84", 
                        position: 1, 
                        team: "MAT SALLEH",
                        participants: [
                            "NUR FAIEISYA FIETIEYA BINTI ABDULLAH",
                            "ASMINI BINTI HAMID",
                            "NUR ALEYA MAISARA BINTI AMRAN",
                            "NURERYANI SUFI BINTI ABDULLAH",
                            "NUR SHUHADA BINTI ABDULLAH"
                        ]
                    },
                    { 
                        name: "AKI ANTANOM Team", 
                        time: "1:18:44", 
                        position: 2, 
                        team: "AKI ANTANOM",
                        participants: [
                            "SITTY NUR ASYIRAH BINTI ROSLI",
                            "NURSAZWANI BINTI LISMAN",
                            "NORFASHA BINTI AMAN",
                            "NUR IZZQUEISHA AIN BINTI JAFNAR",
                            "REZLIN BINTI JUDIP"
                        ]
                    },
                    { 
                        name: "HANG TUAH Team", 
                        time: "1:19:54", 
                        position: 3, 
                        team: "HANG TUAH",
                        participants: [
                            "NUR KHAYLA HANANIA BINTI NUSRI",
                            "ANGIE CRYSTAL JIMMY",
                            "MAS JUHLIANA ROSA BINTI MASARJO",
                            "SITTI NUR QIANA UMAIRAH BINTI MAHADI"
                        ]
                    },
                    { 
                        name: "RENTAP Team", 
                        time: "1:27:37", 
                        position: 4, 
                        team: "RENTAP",
                        participants: [
                            "SITI NORHIDAYAH BINTI ABDULLAH",
                            "NUR DAHLYA NADHIRAH BINTI NUSRI",
                            "MAS JUHAFIKA ROSA BINTI MASARJO",
                            "REZELAYNE JUDIP",
                            "SITI DAYANG INTAN",
                            "NURSAZALNAH BINTI HARRIS",
                            "SUHAINI BINTI ROBIN"
                        ]
                    }
                ]
            },
            {
                id: 14,
                name: "4 X 200 Meter Campuran 9TKB",
                gender: "mixed",
                ageGroup: "9TKB",
                results: []
            },
            {
                id: 15,
                name: "4 X 200 Meter Lelaki 12TKB",
                gender: "male",
                ageGroup: "12TKB",
                results: []
            },
            {
                id: 16,
                name: "4 X 200 Meter Perempuan 12TKB",
                gender: "female",
                ageGroup: "12TKB",
                results: []
            }
        ];

        // Team data
        const teams = [
            { name: "RENTAP", color: "rentap", gold: 0, silver: 0, bronze: 0, total: 0 },
            { name: "MAT SALLEH", color: "mat-salleh", gold: 0, silver: 0, bronze: 0, total: 0 },
            { name: "HANG TUAH", color: "hang-tuah", gold: 0, silver: 0, bronze: 0, total: 0 },
            { name: "AKI ANTANOM", color: "aki-antanom", gold: 0, silver: 0, bronze: 0, total: 0 }
        ];

        // Athlete data
        let athletes = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initNavigation();
            initData();
            renderDashboard();
            renderFieldEvents();
            renderTrackEvents();
            renderMedalAnalysis();
            renderTopAthletes();
            initCharts();
            initQRCode();
            initEventListeners();
            highlightOverallWinner();
            populateEventSelect();
        });

        // Theme toggle functionality
        function initTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            // Check for saved theme or prefer-color-scheme
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            themeToggle.addEventListener('click', function() {
                body.classList.toggle('dark-mode');
                
                if (body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    localStorage.setItem('theme', 'light');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            });
        }

        // Tab navigation functionality
        function initNavigation() {
            // Desktop tabs
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and buttons
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to current tab and button
                    document.getElementById(tabId).classList.add('active');
                    this.classList.add('active');
                    
                    // Update mobile menu
                    document.querySelectorAll('.mobile-menu-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-tab') === tabId) {
                            btn.classList.add('active');
                        }
                    });
                });
            });
            
            // Mobile menu
            const mobileMenuButtons = document.querySelectorAll('.mobile-menu-btn');
            mobileMenuButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and buttons
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.mobile-menu-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to current tab and button
                    document.getElementById(tabId).classList.add('active');
                    this.classList.add('active');
                    
                    // Find and activate corresponding desktop button
                    const desktopButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
                    if (desktopButton) {
                        desktopButton.classList.add('active');
                    }
                });
            });
        }

        // Initialize data and calculate medal counts
        function initData() {
            // Reset team medals
            teams.forEach(team => {
                team.gold = 0;
                team.silver = 0;
                team.bronze = 0;
                team.total = 0;
            });
            
            // Calculate medals from field events
            fieldEvents.forEach(event => {
                event.results.forEach(result => {
                    const team = teams.find(t => t.name === result.team);
                    if (team) {
                        if (result.position === 1) team.gold++;
                        else if (result.position === 2) team.silver++;
                        else if (result.position === 3) team.bronze++;
                        
                        team.total = team.gold + team.silver + team.bronze;
                    }
                });
            });
            
            // Calculate medals from track events
            trackEvents.forEach(event => {
                event.results.forEach(result => {
                    const team = teams.find(t => t.name === result.team);
                    if (team) {
                        if (result.position === 1) team.gold++;
                        else if (result.position === 2) team.silver++;
                        else if (result.position === 3) team.bronze++;
                        
                        team.total = team.gold + team.silver + team.bronze;
                    }
                });
            });
            
            // Sort teams by gold medals, then silver, then bronze
            teams.sort((a, b) => {
                if (b.gold !== a.gold) return b.gold - a.gold;
                if (b.silver !== a.silver) return b.silver - a.silver;
                return b.bronze - a.bronze;
            });
            
            // Build athlete data with points
            athletes = [];
            
            // Process field events for athlete points
            fieldEvents.forEach(event => {
                event.results.forEach(result => {
                    let athlete = athletes.find(a => a.name === result.name);
                    if (!athlete) {
                        athlete = {
                            name: result.name,
                            gender: event.gender,
                            team: result.team,
                            gold: 0,
                            silver: 0,
                            bronze: 0,
                            points: 0
                        };
                        athletes.push(athlete);
                    }
                    
                    if (result.position === 1) {
                        athlete.gold++;
                        athlete.points += 5;
                    } else if (result.position === 2) {
                        athlete.silver++;
                        athlete.points += 3;
                    } else if (result.position === 3) {
                        athlete.bronze++;
                        athlete.points += 1;
                    }
                });
            });
            
            // Process track events for athlete points
            trackEvents.forEach(event => {
                event.results.forEach(result => {
                    // For relay events, add points to all participants
                    if (result.participants) {
                        result.participants.forEach(participantName => {
                            let athlete = athletes.find(a => a.name === participantName);
                            if (!athlete) {
                                // Try to find athlete with similar name
                                const nameParts = participantName.split(' ');
                                const searchName = nameParts.slice(0, 2).join(' ');
                                athlete = athletes.find(a => a.name.includes(searchName));
                                
                                if (!athlete) {
                                    athlete = {
                                        name: participantName,
                                        gender: event.gender === 'mixed' ? 'male' : event.gender,
                                        team: result.team,
                                        gold: 0,
                                        silver: 0,
                                        bronze: 0,
                                        points: 0
                                    };
                                    athletes.push(athlete);
                                }
                            }
                            
                            if (result.position === 1) {
                                athlete.gold++;
                                athlete.points += 5;
                            } else if (result.position === 2) {
                                athlete.silver++;
                                athlete.points += 3;
                            } else if (result.position === 3) {
                                athlete.bronze++;
                                athlete.points += 1;
                            }
                        });
                    } else {
                        // Individual events
                        let athlete = athletes.find(a => a.name === result.name);
                        if (!athlete) {
                            athlete = {
                                name: result.name,
                                gender: event.gender,
                                team: result.team,
                                gold: 0,
                                silver: 0,
                                bronze: 0,
                                points: 0
                            };
                            athletes.push(athlete);
                        }
                        
                        if (result.position === 1) {
                            athlete.gold++;
                            athlete.points += 5;
                        } else if (result.position === 2) {
                            athlete.silver++;
                            athlete.points += 3;
                        } else if (result.position === 3) {
                            athlete.bronze++;
                            athlete.points += 1;
                        }
                    }
                });
            });
            
            // Sort athletes by points
            athletes.sort((a, b) => b.points - a.points);
        }

        // Populate event select dropdown
        function populateEventSelect() {
            const eventSelect = document.getElementById('eventSelect');
            eventSelect.innerHTML = '<option value="">-- Sila pilih acara --</option>';
            
            // Add field events
            fieldEvents.forEach(event => {
                const option = document.createElement('option');
                option.value = `field-${event.id}`;
                option.textContent = `${event.id}. ${event.name} ${event.results.length === 0 ? '(Tiada keputusan)' : ''}`;
                eventSelect.appendChild(option);
            });
            
            // Add track events
            trackEvents.forEach(event => {
                const option = document.createElement('option');
                option.value = `track-${event.id}`;
                option.textContent = `${event.id}. ${event.name} ${event.results.length === 0 ? '(Tiada keputusan)' : ''}`;
                eventSelect.appendChild(option);
            });
        }

        // Render dashboard
        function renderDashboard() {
            const dashboardMedals = document.getElementById('dashboardMedals');
            dashboardMedals.innerHTML = '';
            
            teams.forEach(team => {
                const medalCard = document.createElement('div');
                medalCard.className = `medal-card ${team.color}`;
                medalCard.innerHTML = `
                    <h4>${team.name}</h4>
                    <div class="medal-count">
                        <div class="medal-item">
                            <div class="medal-icon gold"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.gold}</div>
                        </div>
                        <div class="medal-item">
                            <div class="medal-icon silver"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.silver}</div>
                        </div>
                        <div class="medal-item">
                            <div class="medal-icon bronze"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.bronze}</div>
                        </div>
                    </div>
                    <p>Jumlah: ${team.total} pingat</p>
                `;
                
                medalCard.addEventListener('click', function() {
                    // Switch to medals tab and show team details
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    
                    document.querySelector('.tab-button[data-tab="medals"]').classList.add('active');
                    document.getElementById('medals').classList.add('active');
                    
                    // Update mobile menu
                    document.querySelectorAll('.mobile-menu-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-tab') === 'medals') {
                            btn.classList.add('active');
                        }
                    });
                });
                
                dashboardMedals.appendChild(medalCard);
            });
        }

        // Render field events
        function renderFieldEvents(filter = 'all') {
            const fieldEventsContent = document.getElementById('fieldEventsContent');
            fieldEventsContent.innerHTML = '';
            
            let filteredEvents = fieldEvents;
            
            if (filter !== 'all') {
                filteredEvents = fieldEvents.filter(event => {
                    if (filter === 'male') return event.gender === 'male';
                    if (filter === 'female') return event.gender === 'female';
                    if (filter === '12TKB') return event.ageGroup === '12TKB';
                    return true;
                });
            }
            
            if (filteredEvents.length === 0) {
                fieldEventsContent.innerHTML = '<div class="empty-event">Tiada acara padang ditemui.</div>';
                return;
            }
            
            filteredEvents.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'card';
                eventCard.style.marginTop = '20px';
                
                let eventResultsHTML = '';
                
                if (event.results.length === 0) {
                    eventResultsHTML = '<div class="empty-event">Tiada keputusan untuk acara ini.</div>';
                } else {
                    eventResultsHTML = `
                        <table class="event-table">
                            <thead>
                                <tr>
                                    <th>Bil</th>
                                    <th>Nama Peserta</th>
                                    <th>Masa/Jarak</th>
                                    <th>Kedudukan</th>
                                    <th>Pasukan</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${event.results.map(result => `
                                    <tr>
                                        <td>${event.results.indexOf(result) + 1}.</td>
                                        <td>${result.name}</td>
                                        <td>${result.distance || result.height || 'N/A'}</td>
                                        <td>
                                            <span class="position-badge position-${result.position}">
                                                ${result.position}
                                            </span>
                                        </td>
                                        <td>
                                            ${result.team ? `<span class="team-badge team-${result.team.toLowerCase().replace(' ', '-')}">${result.team}</span>` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
                
                const statusClass = event.results.length === 0 ? 'status-incomplete' : 'status-complete';
                const statusText = event.results.length === 0 ? 'Belum Selesai' : 'Selesai';
                
                eventCard.innerHTML = `
                    <h4>${event.id}. ${event.name} <span class="event-status ${statusClass}">${statusText}</span></h4>
                    ${eventResultsHTML}
                `;
                
                fieldEventsContent.appendChild(eventCard);
            });
        }

        // Render track events
        function renderTrackEvents(filter = 'all') {
            const trackEventsContent = document.getElementById('trackEventsContent');
            trackEventsContent.innerHTML = '';
            
            let filteredEvents = trackEvents;
            
            if (filter !== 'all') {
                filteredEvents = trackEvents.filter(event => {
                    if (filter === 'male') return event.gender === 'male';
                    if (filter === 'female') return event.gender === 'female';
                    if (filter === 'mixed') return event.gender === 'mixed';
                    if (filter === 'preschool') return event.ageGroup === 'preschool';
                    if (filter === '9TKB') return event.ageGroup === '9TKB';
                    if (filter === '12TKB') return event.ageGroup === '12TKB';
                    return true;
                });
            }
            
            if (filteredEvents.length === 0) {
                trackEventsContent.innerHTML = '<div class="empty-event">Tiada acara balapan ditemui.</div>';
                return;
            }
            
            filteredEvents.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'card';
                eventCard.style.marginTop = '20px';
                
                let eventResultsHTML = '';
                
                if (event.results.length === 0) {
                    eventResultsHTML = '<div class="empty-event">Tiada keputusan untuk acara ini.</div>';
                } else {
                    eventResultsHTML = `
                        <table class="event-table">
                            <thead>
                                <tr>
                                    <th>Bil</th>
                                    <th>Nama Pasukan/Peserta</th>
                                    <th>Masa/Jarak</th>
                                    <th>Kedudukan</th>
                                    <th>Pasukan</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${event.results.map(result => {
                                    let participantsHTML = '';
                                    if (result.participants && result.participants.length > 0) {
                                        participantsHTML = `<br><small><strong>Ahli Pasukan:</strong> ${result.participants.join(', ')}</small>`;
                                    }
                                    
                                    return `
                                        <tr>
                                            <td>${event.results.indexOf(result) + 1}.</td>
                                            <td>${result.name}${participantsHTML}</td>
                                            <td>${result.time || 'N/A'}</td>
                                            <td>
                                                <span class="position-badge position-${result.position}">
                                                    ${result.position}
                                                </span>
                                            </td>
                                            <td>
                                                ${result.team ? `<span class="team-badge team-${result.team.toLowerCase().replace(' ', '-')}">${result.team}</span>` : ''}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                }
                
                const statusClass = event.results.length === 0 ? 'status-incomplete' : 'status-complete';
                const statusText = event.results.length === 0 ? 'Belum Selesai' : 'Selesai';
                
                eventCard.innerHTML = `
                    <h4>${event.id}. ${event.name} <span class="event-status ${statusClass}">${statusText}</span></h4>
                    ${eventResultsHTML}
                `;
                
                trackEventsContent.appendChild(eventCard);
            });
        }

        // Render medal analysis
        function renderMedalAnalysis() {
            const medalAnalysis = document.getElementById('medalAnalysis');
            medalAnalysis.innerHTML = '';
            
            teams.forEach(team => {
                const medalCard = document.createElement('div');
                medalCard.className = `medal-card ${team.color}`;
                medalCard.innerHTML = `
                    <h4>${team.name}</h4>
                    <div class="medal-count">
                        <div class="medal-item">
                            <div class="medal-icon gold"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.gold}</div>
                        </div>
                        <div class="medal-item">
                            <div class="medal-icon silver"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.silver}</div>
                        </div>
                        <div class="medal-item">
                            <div class="medal-icon bronze"><i class="fas fa-medal"></i></div>
                            <div class="medal-number">${team.bronze}</div>
                        </div>
                    </div>
                    <p>Jumlah: ${team.total} pingat</p>
                `;
                
                medalCard.addEventListener('click', function() {
                    // Show gold medal winners for this team
                    showGoldWinners(team.name);
                });
                
                medalAnalysis.appendChild(medalCard);
            });
        }

        // Show gold medal winners for a team
        function showGoldWinners(teamName) {
            const goldWinners = [];
            
            // Check field events
            fieldEvents.forEach(event => {
                event.results.forEach(result => {
                    if (result.team === teamName && result.position === 1) {
                        goldWinners.push({
                            name: result.name,
                            event: event.name,
                            result: result.distance || result.height || 'N/A'
                        });
                    }
                });
            });
            
            // Check track events
            trackEvents.forEach(event => {
                event.results.forEach(result => {
                    if (result.team === teamName && result.position === 1) {
                        // For relay events, add all participants
                        if (result.participants) {
                            result.participants.forEach(participant => {
                                goldWinners.push({
                                    name: participant,
                                    event: event.name,
                                    result: result.time || 'N/A'
                                });
                            });
                        } else {
                            goldWinners.push({
                                name: result.name,
                                event: event.name,
                                result: result.time || 'N/A'
                            });
                        }
                    }
                });
            });
            
            if (goldWinners.length > 0) {
                let message = `Pemenang Emas untuk ${teamName}:\n\n`;
                goldWinners.forEach(winner => {
                    message += `• ${winner.name} - ${winner.event} (${winner.result})\n`;
                });
                
                alert(message);
            } else {
                alert(`Tiada pemenang emas untuk ${teamName}.`);
            }
        }

        // Render top athletes
        function renderTopAthletes(filter = 'all') {
            const topAthletesContent = document.getElementById('topAthletesContent');
            topAthletesContent.innerHTML = '';
            
            let filteredAthletes = athletes;
            
            if (filter !== 'all') {
                if (filter === 'male') {
                    filteredAthletes = athletes.filter(a => a.gender === 'male');
                } else if (filter === 'female') {
                    filteredAthletes = athletes.filter(a => a.gender === 'female');
                } else if (filter === 'preschool') {
                    // Filter preschool athletes (based on name or team)
                    filteredAthletes = athletes.filter(a => {
                        return a.name.includes('PRASEKOLAH') || 
                               trackEvents.some(event => 
                                   event.ageGroup === 'preschool' && 
                                   event.results.some(result => result.name === a.name)
                               );
                    });
                }
            }
            
            // Take top 20 athletes
            const topAthletes = filteredAthletes.slice(0, 20);
            
            if (topAthletes.length === 0) {
                topAthletesContent.innerHTML = '<div class="empty-event">Tiada atlet ditemui.</div>';
                return;
            }
            
            topAthletes.forEach((athlete, index) => {
                const athleteCard = document.createElement('div');
                athleteCard.className = 'athlete-card';
                if (index === 0) athleteCard.classList.add('winner-highlight');
                
                // Get first letter for avatar
                const firstLetter = athlete.name.charAt(0);
                
                athleteCard.innerHTML = `
                    <div class="athlete-avatar">${firstLetter}</div>
                    <div class="athlete-info">
                        <h4>${athlete.name}</h4>
                        <p>${athlete.team || 'Tiada Pasukan'}</p>
                        <p>
                            <i class="fas fa-medal gold"></i> ${athlete.gold} 
                            <i class="fas fa-medal silver" style="margin-left: 10px;"></i> ${athlete.silver} 
                            <i class="fas fa-medal bronze" style="margin-left: 10px;"></i> ${athlete.bronze}
                        </p>
                    </div>
                    <div class="points-badge">${athlete.points} Mata</div>
                `;
                
                topAthletesContent.appendChild(athleteCard);
            });
        }

        // Initialize charts
        function initCharts() {
            // Medal Chart
            const medalCtx = document.getElementById('medalChart').getContext('2d');
            new Chart(medalCtx, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [
                        {
                            label: 'Emas',
                            data: teams.map(team => team.gold),
                            backgroundColor: 'gold',
                            borderColor: 'gold',
                            borderWidth: 1
                        },
                        {
                            label: 'Perak',
                            data: teams.map(team => team.silver),
                            backgroundColor: 'silver',
                            borderColor: 'silver',
                            borderWidth: 1
                        },
                        {
                            label: 'Gangsa',
                            data: teams.map(team => team.bronze),
                            backgroundColor: '#cd7f32',
                            borderColor: '#cd7f32',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Jumlah Pingat Mengikut Pasukan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Medal Type Chart
            const medalTypeCtx = document.getElementById('medalTypeChart').getContext('2d');
            const totalGold = teams.reduce((sum, team) => sum + team.gold, 0);
            const totalSilver = teams.reduce((sum, team) => sum + team.silver, 0);
            const totalBronze = teams.reduce((sum, team) => sum + team.bronze, 0);
            
            new Chart(medalTypeCtx, {
                type: 'pie',
                data: {
                    labels: ['Emas', 'Perak', 'Gangsa'],
                    datasets: [{
                        data: [totalGold, totalSilver, totalBronze],
                        backgroundColor: ['gold', 'silver', '#cd7f32'],
                        borderColor: ['#fff', '#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Peratusan Pingat Keseluruhan'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Team Medal Chart (for medals tab)
            const teamMedalCtx = document.getElementById('teamMedalChart').getContext('2d');
            new Chart(teamMedalCtx, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        label: 'Jumlah Pingat',
                        data: teams.map(team => team.total),
                        backgroundColor: [
                            'var(--rentap)',
                            'var(--mat-salleh)',
                            'var(--hang-tuah)',
                            'var(--aki-antanom)'
                        ],
                        borderColor: [
                            'var(--rentap)',
                            'var(--mat-salleh)',
                            'var(--hang-tuah)',
                            'var(--aki-antanom)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Jumlah Keseluruhan Pingat Mengikut Pasukan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Medal Pie Chart (for medals tab)
            const medalPieCtx = document.getElementById('medalPieChart').getContext('2d');
            new Chart(medalPieCtx, {
                type: 'pie',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        data: teams.map(team => team.total),
                        backgroundColor: [
                            'var(--rentap)',
                            'var(--mat-salleh)',
                            'var(--hang-tuah)',
                            'var(--aki-antanom)'
                        ],
                        borderColor: ['#fff', '#fff', '#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Peratusan Pingat Mengikut Pasukan'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Top Athletes Chart
            const topAthletesCtx = document.getElementById('topAthletesChart').getContext('2d');
            const top10Athletes = athletes.slice(0, 10);
            
            new Chart(topAthletesCtx, {
                type: 'bar',
                data: {
                    labels: top10Athletes.map(a => a.name.split(' ')[0] + '...'),
                    datasets: [{
                        label: 'Mata',
                        data: top10Athletes.map(a => a.points),
                        backgroundColor: top10Athletes.map(a => {
                            if (a.team === 'RENTAP') return 'var(--rentap)';
                            if (a.team === 'MAT SALLEH') return 'var(--mat-salleh)';
                            if (a.team === 'HANG TUAH') return 'var(--hang-tuah)';
                            if (a.team === 'AKI ANTANOM') return 'var(--aki-antanom)';
                            return '#6c757d';
                        }),
                        borderColor: '#343a40',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '10 Atlet Terbaik (Mata Individu)'
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Team Points Chart
            const teamPointsCtx = document.getElementById('teamPointsChart').getContext('2d');
            const teamPoints = teams.map(team => {
                // Calculate points (5 for gold, 3 for silver, 1 for bronze)
                return (team.gold * 5) + (team.silver * 3) + (team.bronze * 1);
            });
            
            new Chart(teamPointsCtx, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [{
                        label: 'Mata Pasukan',
                        data: teamPoints,
                        backgroundColor: [
                            'var(--rentap)',
                            'var(--mat-salleh)',
                            'var(--hang-tuah)',
                            'var(--aki-antanom)'
                        ],
                        borderColor: [
                            'var(--rentap)',
                            'var(--mat-salleh)',
                            'var(--hang-tuah)',
                            'var(--aki-antanom)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Mata Keseluruhan Pasukan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gender Distribution Chart
            const genderCtx = document.getElementById('genderDistributionChart').getContext('2d');
            const maleAthletes = athletes.filter(a => a.gender === 'male').length;
            const femaleAthletes = athletes.filter(a => a.gender === 'female').length;
            
            new Chart(genderCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Lelaki', 'Perempuan'],
                    datasets: [{
                        data: [maleAthletes, femaleAthletes],
                        backgroundColor: ['#1e88e5', '#e91e63'],
                        borderColor: ['#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Taburan Atlet Mengikut Jantina'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Age Group Chart
            const ageCtx = document.getElementById('ageGroupChart').getContext('2d');
            
            // Count events by age group
            const ageGroups = {
                'Prasekolah': 0,
                '9 Tahun Ke Bawah': 0,
                '12 Tahun Ke Bawah': 0
            };
            
            fieldEvents.forEach(event => {
                if (event.ageGroup === 'preschool') ageGroups['Prasekolah']++;
                else if (event.ageGroup === '9TKB') ageGroups['9 Tahun Ke Bawah']++;
                else if (event.ageGroup === '12TKB') ageGroups['12 Tahun Ke Bawah']++;
            });
            
            trackEvents.forEach(event => {
                if (event.ageGroup === 'preschool') ageGroups['Prasekolah']++;
                else if (event.ageGroup === '9TKB') ageGroups['9 Tahun Ke Bawah']++;
                else if (event.ageGroup === '12TKB') ageGroups['12 Tahun Ke Bawah']++;
            });
            
            new Chart(ageCtx, {
                type: 'polarArea',
                data: {
                    labels: Object.keys(ageGroups),
                    datasets: [{
                        data: Object.values(ageGroups),
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                        borderColor: ['#fff', '#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Taburan Acara Mengikut Kumpulan Umur'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Event Type Chart
            const eventCtx = document.getElementById('eventTypeChart').getContext('2d');
            const fieldEventCount = fieldEvents.length;
            const trackEventCount = trackEvents.length;
            
            new Chart(eventCtx, {
                type: 'pie',
                data: {
                    labels: ['Acara Padang', 'Acara Balapan'],
                    datasets: [{
                        data: [fieldEventCount, trackEventCount],
                        backgroundColor: ['#4CAF50', '#2196F3'],
                        borderColor: ['#fff', '#fff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Taburan Jenis Acara'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Initialize QR Code
        function initQRCode() {
            const qrcodeElement = document.getElementById('qrcode');
            const currentURL = window.location.href;
            
            // Clear previous QR code
            qrcodeElement.innerHTML = '';
            
            // Generate new QR code
            new QRCode(qrcodeElement, {
                text: currentURL,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Initialize event listeners
        function initEventListeners() {
            // Search functionality for field events
            const searchField = document.getElementById('searchField');
            searchField.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const fieldEventsContent = document.getElementById('fieldEventsContent');
                
                if (searchTerm === '') {
                    renderFieldEvents();
                    return;
                }
                
                // Filter events based on search term
                const filteredEvents = fieldEvents.filter(event => {
                    // Check if event name contains search term
                    if (event.name.toLowerCase().includes(searchTerm)) return true;
                    
                    // Check if any result contains search term
                    return event.results.some(result => 
                        result.name.toLowerCase().includes(searchTerm) ||
                        result.team.toLowerCase().includes(searchTerm)
                    );
                });
                
                // Render filtered events
                if (filteredEvents.length === 0) {
                    fieldEventsContent.innerHTML = '<div class="empty-event">Tiada acara padang ditemui.</div>';
                    return;
                }
                
                fieldEventsContent.innerHTML = '';
                filteredEvents.forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'card';
                    eventCard.style.marginTop = '20px';
                    
                    let eventResultsHTML = '';
                    
                    if (event.results.length === 0) {
                        eventResultsHTML = '<div class="empty-event">Tiada keputusan untuk acara ini.</div>';
                    } else {
                        eventResultsHTML = `
                            <table class="event-table">
                                <thead>
                                    <tr>
                                        <th>Bil</th>
                                        <th>Nama Peserta</th>
                                        <th>Masa/Jarak</th>
                                        <th>Kedudukan</th>
                                        <th>Pasukan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${event.results.map(result => `
                                        <tr>
                                            <td>${event.results.indexOf(result) + 1}.</td>
                                            <td>${result.name}</td>
                                            <td>${result.distance || result.height || 'N/A'}</td>
                                            <td>
                                                <span class="position-badge position-${result.position}">
                                                    ${result.position}
                                                </span>
                                            </td>
                                            <td>
                                                ${result.team ? `<span class="team-badge team-${result.team.toLowerCase().replace(' ', '-')}">${result.team}</span>` : ''}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                    
                    const statusClass = event.results.length === 0 ? 'status-incomplete' : 'status-complete';
                    const statusText = event.results.length === 0 ? 'Belum Selesai' : 'Selesai';
                    
                    eventCard.innerHTML = `
                        <h4>${event.id}. ${event.name} <span class="event-status ${statusClass}">${statusText}</span></h4>
                        ${eventResultsHTML}
                    `;
                    
                    fieldEventsContent.appendChild(eventCard);
                });
            });
            
            // Search functionality for track events
            const searchTrack = document.getElementById('searchTrack');
            searchTrack.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const trackEventsContent = document.getElementById('trackEventsContent');
                
                if (searchTerm === '') {
                    renderTrackEvents();
                    return;
                }
                
                // Filter events based on search term
                const filteredEvents = trackEvents.filter(event => {
                    // Check if event name contains search term
                    if (event.name.toLowerCase().includes(searchTerm)) return true;
                    
                    // Check if any result contains search term
                    return event.results.some(result => {
                        if (result.name.toLowerCase().includes(searchTerm) ||
                            result.team.toLowerCase().includes(searchTerm)) return true;
                        
                        // Check participants in relay events
                        if (result.participants) {
                            return result.participants.some(participant => 
                                participant.toLowerCase().includes(searchTerm)
                            );
                        }
                        
                        return false;
                    });
                });
                
                // Render filtered events
                if (filteredEvents.length === 0) {
                    trackEventsContent.innerHTML = '<div class="empty-event">Tiada acara balapan ditemui.</div>';
                    return;
                }
                
                trackEventsContent.innerHTML = '';
                filteredEvents.forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'card';
                    eventCard.style.marginTop = '20px';
                    
                    let eventResultsHTML = '';
                    
                    if (event.results.length === 0) {
                        eventResultsHTML = '<div class="empty-event">Tiada keputusan untuk acara ini.</div>';
                    } else {
                        eventResultsHTML = `
                            <table class="event-table">
                                <thead>
                                    <tr>
                                        <th>Bil</th>
                                        <th>Nama Pasukan/Peserta</th>
                                        <th>Masa/Jarak</th>
                                        <th>Kedudukan</th>
                                        <th>Pasukan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${event.results.map(result => {
                                        let participantsHTML = '';
                                        if (result.participants && result.participants.length > 0) {
                                            participantsHTML = `<br><small><strong>Ahli Pasukan:</strong> ${result.participants.join(', ')}</small>`;
                                        }
                                        
                                        return `
                                            <tr>
                                                <td>${event.results.indexOf(result) + 1}.</td>
                                                <td>${result.name}${participantsHTML}</td>
                                                <td>${result.time || 'N/A'}</td>
                                                <td>
                                                    <span class="position-badge position-${result.position}">
                                                        ${result.position}
                                                    </span>
                                                </td>
                                                <td>
                                                    ${result.team ? `<span class="team-badge team-${result.team.toLowerCase().replace(' ', '-')}">${result.team}</span>` : ''}
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                    
                    const statusClass = event.results.length === 0 ? 'status-incomplete' : 'status-complete';
                    const statusText = event.results.length === 0 ? 'Belum Selesai' : 'Selesai';
                    
                    eventCard.innerHTML = `
                        <h4>${event.id}. ${event.name} <span class="event-status ${statusClass}">${statusText}</span></h4>
                        ${eventResultsHTML}
                    `;
                    
                    trackEventsContent.appendChild(eventCard);
                });
            });
            
            // Filter buttons for field events
            document.querySelectorAll('#field .filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('#field .filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Get filter value
                    const filter = this.getAttribute('data-filter');
                    
                    // Render filtered events
                    renderFieldEvents(filter);
                });
            });
            
            // Filter buttons for track events
            document.querySelectorAll('#track .filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('#track .filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Get filter value
                    const filter = this.getAttribute('data-filter');
                    
                    // Render filtered events
                    renderTrackEvents(filter);
                });
            });
            
            // Filter buttons for athletes
            document.querySelectorAll('#athletes .filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('#athletes .filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Get filter value
                    const filter = this.getAttribute('data-athlete-filter');
                    
                    // Render filtered athletes
                    renderTopAthletes(filter);
                });
            });
            
            // Export buttons
            document.getElementById('exportDashboard').addEventListener('click', function() {
                exportToPDF('dashboard');
            });
            
            document.getElementById('exportField').addEventListener('click', function() {
                exportToPDF('field');
            });
            
            document.getElementById('exportTrack').addEventListener('click', function() {
                exportToPDF('track');
            });
            
            document.getElementById('exportMedals').addEventListener('click', function() {
                exportToPDF('medals');
            });
            
            document.getElementById('exportAthletes').addEventListener('click', function() {
                exportToPDF('athletes');
            });
            
            document.getElementById('exportAnalysis').addEventListener('click', function() {
                exportToPDF('analysis');
            });
            
            // Download QR Code
            document.getElementById('downloadQR').addEventListener('click', function() {
                const qrcodeCanvas = document.querySelector('#qrcode canvas');
                if (qrcodeCanvas) {
                    const link = document.createElement('a');
                    link.download = 'qr-code-keputusan-olahraga.png';
                    link.href = qrcodeCanvas.toDataURL('image/png');
                    link.click();
                }
            });
            
            // Admin buttons
            document.getElementById('updateResults').addEventListener('click', function() {
                openUpdateEventModal();
            });
            
            document.getElementById('addEvent').addEventListener('click', function() {
                alert('Fungsi tambah acara baru akan dibangunkan pada fasa seterusnya.');
            });
            
            document.getElementById('resetData').addEventListener('click', function() {
                if (confirm('Adakah anda pasti ingin reset semua data? Tindakan ini tidak boleh dibatalkan.')) {
                    // Reset to original data
                    fieldEvents = JSON.parse(JSON.stringify(originalFieldEvents));
                    trackEvents = JSON.parse(JSON.stringify(originalTrackEvents));
                    
                    initData();
                    renderDashboard();
                    renderFieldEvents();
                    renderTrackEvents();
                    renderMedalAnalysis();
                    renderTopAthletes();
                    initCharts();
                    populateEventSelect();
                    renderIncompleteEvents();
                    alert('Data telah direset kepada nilai asal.');
                }
            });
            
            document.getElementById('importCSV').addEventListener('click', function() {
                const fileInput = document.getElementById('csvUpload');
                if (fileInput.files.length > 0) {
                    alert('Fail CSV berjaya dimuat naik. Pemprosesan data akan dilakukan pada fasa seterusnya.');
                } else {
                    alert('Sila pilih fail CSV terlebih dahulu.');
                }
            });
            
            // Modal event listeners
            document.getElementById('closeModal').addEventListener('click', function() {
                closeUpdateEventModal();
            });
            
            document.getElementById('cancelUpdate').addEventListener('click', function() {
                closeUpdateEventModal();
            });
            
            document.getElementById('addParticipant').addEventListener('click', function() {
                addParticipantRow();
            });
            
            // Event select change
            document.getElementById('eventSelect').addEventListener('change', function() {
                const value = this.value;
                if (value) {
                    loadEventData(value);
                }
            });
            
            // Update event form submission
            document.getElementById('updateEventForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEventChanges();
            });
            
            // Save original data for reset
            const originalFieldEvents = JSON.parse(JSON.stringify(fieldEvents));
            const originalTrackEvents = JSON.parse(JSON.stringify(trackEvents));
            
            // Render incomplete events
            renderIncompleteEvents();
        }

        // Open update event modal
        function openUpdateEventModal() {
            const modal = document.getElementById('updateEventModal');
            modal.style.display = 'flex';
            
            // Clear form
            document.getElementById('eventSelect').value = '';
            document.getElementById('eventName').value = '';
            document.getElementById('categoryField').checked = true;
            document.getElementById('genderMale').checked = true;
            document.getElementById('ageGroup').value = '12TKB';
            
            // Clear participants
            const participantsContainer = document.getElementById('participantsContainer');
            participantsContainer.innerHTML = '';
            
            // Add initial participant row
            addParticipantRow();
        }

        // Close update event modal
        function closeUpdateEventModal() {
            const modal = document.getElementById('updateEventModal');
            modal.style.display = 'none';
        }

        // Add participant row to form
        function addParticipantRow() {
            const participantsContainer = document.getElementById('participantsContainer');
            const participantCount = participantsContainer.children.length + 1;
            
            const participantRow = document.createElement('div');
            participantRow.className = 'participant-row';
            participantRow.innerHTML = `
                <input type="text" class="form-control participant-name" placeholder="Nama Peserta ${participantCount}" required>
                <input type="text" class="form-control participant-result" placeholder="Masa/Jarak" required>
                <select class="form-control participant-position" required>
                    <option value="">Kedudukan</option>
                    <option value="1">1 (Emas)</option>
                    <option value="2">2 (Perak)</option>
                    <option value="3">3 (Gangsa)</option>
                    <option value="4">4</option>
                </select>
                <select class="form-control participant-team" required>
                    <option value="">Pasukan</option>
                    <option value="RENTAP">RENTAP</option>
                    <option value="MAT SALLEH">MAT SALLEH</option>
                    <option value="HANG TUAH">HANG TUAH</option>
                    <option value="AKI ANTANOM">AKI ANTANOM</option>
                </select>
                <button type="button" class="remove-participant">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            participantsContainer.appendChild(participantRow);
            
            // Add event listener to remove button
            participantRow.querySelector('.remove-participant').addEventListener('click', function() {
                if (participantsContainer.children.length > 1) {
                    participantRow.remove();
                }
            });
        }

        // Load event data into form
        function loadEventData(eventId) {
            const [category, id] = eventId.split('-');
            const eventIdNum = parseInt(id);
            
            let event;
            if (category === 'field') {
                event = fieldEvents.find(e => e.id === eventIdNum);
            } else {
                event = trackEvents.find(e => e.id === eventIdNum);
            }
            
            if (!event) return;
            
            // Populate form fields
            document.getElementById('eventName').value = event.name;
            
            // Set category
            if (category === 'field') {
                document.getElementById('categoryField').checked = true;
            } else {
                document.getElementById('categoryTrack').checked = true;
            }
            
            // Set gender
            if (event.gender === 'male') {
                document.getElementById('genderMale').checked = true;
            } else if (event.gender === 'female') {
                document.getElementById('genderFemale').checked = true;
            } else {
                document.getElementById('genderMixed').checked = true;
            }
            
            // Set age group
            document.getElementById('ageGroup').value = event.ageGroup;
            
            // Clear and populate participants
            const participantsContainer = document.getElementById('participantsContainer');
            participantsContainer.innerHTML = '';
            
            if (event.results && event.results.length > 0) {
                event.results.forEach(result => {
                    const participantRow = document.createElement('div');
                    participantRow.className = 'participant-row';
                    participantRow.innerHTML = `
                        <input type="text" class="form-control participant-name" value="${result.name}" required>
                        <input type="text" class="form-control participant-result" value="${result.distance || result.height || result.time || ''}" required>
                        <select class="form-control participant-position" required>
                            <option value="">Kedudukan</option>
                            <option value="1" ${result.position === 1 ? 'selected' : ''}>1 (Emas)</option>
                            <option value="2" ${result.position === 2 ? 'selected' : ''}>2 (Perak)</option>
                            <option value="3" ${result.position === 3 ? 'selected' : ''}>3 (Gangsa)</option>
                            <option value="4" ${result.position === 4 ? 'selected' : ''}>4</option>
                        </select>
                        <select class="form-control participant-team" required>
                            <option value="">Pasukan</option>
                            <option value="RENTAP" ${result.team === 'RENTAP' ? 'selected' : ''}>RENTAP</option>
                            <option value="MAT SALLEH" ${result.team === 'MAT SALLEH' ? 'selected' : ''}>MAT SALLEH</option>
                            <option value="HANG TUAH" ${result.team === 'HANG TUAH' ? 'selected' : ''}>HANG TUAH</option>
                            <option value="AKI ANTANOM" ${result.team === 'AKI ANTANOM' ? 'selected' : ''}>AKI ANTANOM</option>
                        </select>
                        <button type="button" class="remove-participant">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    participantsContainer.appendChild(participantRow);
                    
                    // Add event listener to remove button
                    participantRow.querySelector('.remove-participant').addEventListener('click', function() {
                        if (participantsContainer.children.length > 1) {
                            participantRow.remove();
                        }
                    });
                });
            } else {
                // Add one empty row if no results
                addParticipantRow();
            }
        }

        // Save event changes
        function saveEventChanges() {
            const eventSelect = document.getElementById('eventSelect');
            const eventName = document.getElementById('eventName').value;
            const category = document.querySelector('input[name="category"]:checked').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const ageGroup = document.getElementById('ageGroup').value;
            
            // Get participants data
            const participantRows = document.querySelectorAll('.participant-row');
            const results = [];
            
            participantRows.forEach(row => {
                const name = row.querySelector('.participant-name').value;
                const resultValue = row.querySelector('.participant-result').value;
                const position = parseInt(row.querySelector('.participant-position').value);
                const team = row.querySelector('.participant-team').value;
                
                if (name && resultValue && position && team) {
                    // Determine if it's distance, height, or time based on event type
                    let resultObj = { name, position, team };
                    
                    if (category === 'field') {
                        // For field events, check if it's a distance or height event
                        if (eventName.toLowerCase().includes('lompat tinggi')) {
                            resultObj.height = resultValue;
                        } else {
                            resultObj.distance = resultValue;
                        }
                    } else {
                        // For track events, it's time
                        resultObj.time = resultValue;
                    }
                    
                    results.push(resultObj);
                }
            });
            
            if (results.length === 0) {
                alert('Sila masukkan sekurang-kurangnya satu peserta yang sah.');
                return;
            }
            
            // Sort results by position
            results.sort((a, b) => a.position - b.position);
            
            // Update the event
            const eventId = eventSelect.value;
            if (!eventId) {
                alert('Sila pilih acara terlebih dahulu.');
                return;
            }
            
            const [cat, id] = eventId.split('-');
            const eventIdNum = parseInt(id);
            
            if (cat === 'field') {
                const eventIndex = fieldEvents.findIndex(e => e.id === eventIdNum);
                if (eventIndex !== -1) {
                    fieldEvents[eventIndex].name = eventName;
                    fieldEvents[eventIndex].gender = gender;
                    fieldEvents[eventIndex].ageGroup = ageGroup;
                    fieldEvents[eventIndex].results = results;
                }
            } else {
                const eventIndex = trackEvents.findIndex(e => e.id === eventIdNum);
                if (eventIndex !== -1) {
                    trackEvents[eventIndex].name = eventName;
                    trackEvents[eventIndex].gender = gender;
                    trackEvents[eventIndex].ageGroup = ageGroup;
                    trackEvents[eventIndex].results = results;
                }
            }
            
            // Reinitialize data and refresh displays
            initData();
            renderDashboard();
            renderFieldEvents();
            renderTrackEvents();
            renderMedalAnalysis();
            renderTopAthletes();
            initCharts();
            renderIncompleteEvents();
            
            // Close modal and show success message
            closeUpdateEventModal();
            alert('Keputusan acara berjaya dikemaskini!');
        }

        // Render incomplete events for admin panel
        function renderIncompleteEvents() {
            const incompleteEventsList = document.getElementById('incompleteEvents');
            incompleteEventsList.innerHTML = '';
            
            // Check for events with no results
            const incompleteFieldEvents = fieldEvents.filter(event => event.results.length === 0);
            const incompleteTrackEvents = trackEvents.filter(event => event.results.length === 0);
            
            const allIncompleteEvents = [...incompleteFieldEvents, ...incompleteTrackEvents];
            
            if (allIncompleteEvents.length === 0) {
                incompleteEventsList.innerHTML = '<li>Semua acara telah mempunyai keputusan.</li>';
            } else {
                allIncompleteEvents.forEach(event => {
                    const li = document.createElement('li');
                    li.className = 'incomplete-event-item';
                    
                    const eventType = fieldEvents.includes(event) ? 'Padang' : 'Balapan';
                    
                    li.innerHTML = `
                        <div>
                            <strong>${event.id}. ${event.name}</strong>
                            <br><small>${eventType} • ${event.gender === 'male' ? 'Lelaki' : event.gender === 'female' ? 'Perempuan' : 'Campuran'} • ${getAgeGroupText(event.ageGroup)}</small>
                        </div>
                        <div class="event-actions">
                            <button class="edit-event-btn" data-id="${fieldEvents.includes(event) ? 'field' : 'track'}-${event.id}">
                                <i class="fas fa-edit"></i> Kemaskini
                            </button>
                        </div>
                    `;
                    
                    incompleteEventsList.appendChild(li);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-event-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-id');
                        
                        // Open modal
                        openUpdateEventModal();
                        
                        // Set the event select value
                        document.getElementById('eventSelect').value = eventId;
                        
                        // Load event data
                        loadEventData(eventId);
                    });
                });
            }
        }

        // Helper function to get age group text
        function getAgeGroupText(ageGroup) {
            switch(ageGroup) {
                case 'preschool': return 'Prasekolah';
                case '9TKB': return '9 Tahun Ke Bawah';
                case '12TKB': return '12 Tahun Ke Bawah';
                default: return ageGroup;
            }
        }

        // Highlight overall winner
        function highlightOverallWinner() {
            // Find team with most gold medals
            let winner = teams[0];
            
            // Check if there's a tie
            const tiedTeams = teams.filter(team => 
                team.gold === winner.gold && 
                team.silver === winner.silver && 
                team.bronze === winner.bronze
            );
            
            if (tiedTeams.length > 1) {
                console.log('Terdapat seri antara beberapa pasukan.');
            } else {
                console.log(`Juara keseluruhan: ${winner.name}`);
            }
        }

        // Export to PDF function
        function exportToPDF(tab) {
            alert(`Fungsi export PDF untuk ${tab} akan dibangunkan pada fasa seterusnya.\n\nUntuk sekarang, anda boleh menggunakan fungsi print dari browser (Ctrl+P) dan save sebagai PDF.`);
            
            // For future implementation:
            // const { jsPDF } = window.jspdf;
            // const doc = new jsPDF();
            // doc.text(`Laporan ${tab} - Kejohanan Olahraga SK Mapan-Mapan`, 10, 10);
            // doc.save(`keputusan-${tab}.pdf`);
        }
    </script>
</body>
</html>